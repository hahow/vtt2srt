#!/usr/bin/env node

const fs = require('fs')
const path = require('path')

const baseDir = path.resolve(path.join(__dirname, '..'))
const vtt2srt = require(`${baseDir}/lib/index`)

const values = o => Object.keys(o).map(k => o[k])

const yargs = require('yargs')
  .usage('usage: $0 -i vtt_file [-o srt_file]')
  .option('input', {
    alias: 'i',
    coerce: fs.readFileSync,
    describe: 'file holds content to be converted'
  })
  .option('output', {
    alias: 'o',
    describe: `file to hold converted result,
WARNING: content of file would be WIPED OUT`
  })
  .option('from', {
    alias: 'f',
    choices: values(vtt2srt.FROM_FORMATS),
    default: vtt2srt.FROM_FORMATS.VTT,
    describe: 'format to convert from'
  })
  .option('to', {
    alias: 't',
    choices: values(vtt2srt.TO_FORMATS),
    default: vtt2srt.TO_FORMATS.SRT,
    describe: 'format to convert to'
  })
  .demandOption(['input'], 'please specify file to convert')
  .help().argv

const { input, output } = yargs

vtt2srt(input.toString()).then(srtStr => {
  if (!output) {
    return console.log(srtStr)
  }
  return fs.writeFile(output, srtStr)
})
